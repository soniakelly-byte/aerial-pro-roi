<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Aerial Pro â€” ROI Calculator (v9)</title>
  <style>
    :root{--brand:#3F48E9;--brand-dk:#2E36C8;--panel:#ffffff;--muted:#64748b;--ink:#0f172a;--good:#22c55e;--bad:#ef4444}
    *{box-sizing:border-box}
    body{margin:0;background:#f1f5f9;font:14px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;color:var(--ink)}
    .wrap{max-width:1080px;margin:0 auto;padding:24px}
    h1{font-size:24px;font-weight:700;margin:0}
    .sub{color:var(--muted);margin:6px 0 16px}
    .toolbar{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
    .grid{display:grid;gap:16px}
    .cols-3{grid-template-columns:repeat(3,minmax(0,1fr))}
    .cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}
    .card{background:var(--panel);border-radius:16px;box-shadow:0 2px 12px rgba(0,0,0,.06)}
    .card h3{margin:0;padding:14px 16px;border-bottom:1px solid #e5e7eb;font-size:16px;display:flex;align-items:center;gap:8px}
    .card .body{padding:16px}
    label{display:block;font-size:12px;color:#475569;margin-bottom:6px}
    input[type=number]{width:100%;padding:10px 12px;border:1px solid #e5e7eb;border-radius:12px;color:#0f172a}
    input::placeholder{color:#94a3b8}
    input[type="number"]{appearance:textfield;-moz-appearance:textfield}
    input[type="number"]::-webkit-outer-spin-button,
    input[type="number"]::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}

    .row{display:grid;grid-template-columns:minmax(200px,1fr) max-content;align-items:center;gap:8px;width:100%}
    .row input{width:100%;min-width:0}
    .suffix{color:var(--muted);font-size:12px;text-align:right;white-space:nowrap}

    .btns{display:flex;gap:8px;flex-wrap:wrap}
    button{border:0;border-radius:12px;padding:10px 14px;background:var(--brand);color:#fff;cursor:pointer}
    button:hover{background:var(--brand-dk)}
    button.ghost{background:#fff;color:#111827;border:1px solid #e5e7eb}

    .seg{display:flex;gap:6px;align-items:center;background:#e5e7eb66;border-radius:12px;padding:4px}
    .seg button{background:transparent;color:#111827;padding:8px 12px;border-radius:10px}
    .seg button.active{background:var(--brand);color:#fff}

    .stats{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px}
    .stat{background:#fff;border-radius:16px;padding:12px;box-shadow:0 1px 6px rgba(0,0,0,.05)}
    .stat .k{color:#6b7280;font-size:12px}
    .stat .v{font-size:20px;font-weight:700}

    .barlist{display:grid;gap:12px}
    /* Reworked bar to show value UNDER the bar (better mobile UX) */
    .bar{display:grid;grid-template-columns:160px 1fr;grid-template-rows:auto auto;gap:4px 10px;align-items:center}
    .bar .label{grid-column:1;grid-row:1;font-size:12px;color:#374151}
    .bar .track{grid-column:2;grid-row:1;background:#e5e7eb;border-radius:999px;overflow:hidden;height:12px}
    .bar .fill{height:100%;background:var(--good)}
    .bar.neg .fill{background:var(--bad)}
    .bar .val{grid-column:1 / span 2;grid-row:2;font-size:12px;color:#0f172a;display:flex;justify-content:flex-end}

    .note{font-size:12px;color:#64748b}
    .header{display:flex;align-items:end;justify-content:space-between;gap:12px;margin-bottom:8px}
    .presetBox{display:flex;flex-direction:column;gap:6px;align-items:flex-end}
    .presetHint{font-size:12px;color:#64748b}
    .help{display:inline-flex;align-items:center;justify-content:center;width:16px;height:16px;border-radius:50%;background:var(--brand);color:#fff;font-size:11px;cursor:help}

    /* Program costs: stack rows */
    .costs-stack{grid-template-columns:1fr !important}

    /* Annual note (no buttony look) */
    .annualNote{font-size:13px;color:var(--muted);padding:2px 0}
    .annualNote .lock{margin-right:6px}

    /* Print styles */
    .printOnly{display:none}
    @media print{
      body{background:#fff}
      .seg,.btns,.presetHint,.help,button{display:none !important}
      .card{box-shadow:none;border:1px solid #e5e7eb}
      .wrap{max-width:1024px}
      .printOnly{display:block}
    }

    @media (max-width:900px){
      .cols-3{grid-template-columns:1fr}
      .cols-2{grid-template-columns:1fr}
      .bar{grid-template-columns:1fr;grid-template-rows:auto auto auto}
      .bar .label{grid-column:1;grid-row:1}
      .bar .track{grid-column:1;grid-row:2}
      .bar .val{grid-column:1;grid-row:3;justify-content:flex-start}
      .presetBox{align-items:flex-start}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="header">
      <div>
        <h1>Aerial Pro â€” Clientâ€‘Facing ROI Calculator</h1>
        <p class="sub">Annual model. Adjust flights and assumptions to match your operations. Results update instantly; nothing is saved to a server.</p>
        <div class="toolbar">
          <button class="ghost" id="openPrint">Open print view</button>
          <button id="printPdf">Print / Save PDF</button>
        </div>
      </div>
      <div class="presetBox">
        <div class="seg" role="tablist" aria-label="Preset selector">
          <button id="pConservative" class="active" aria-selected="true">Conservative</button>
          <button id="pBase">Base</button>
          <button id="pAggressive">Aggressive</button>
        </div>
        <div class="presetHint">Preset applies typical values across inputs (you can still tweak fields).</div>
      </div>
    </div>

    <div class="grid cols-3">
      <!-- Left: Inputs -->
      <div class="card" style="grid-column: span 2">
        <h3>Inputs</h3>
        <div class="body grid" style="gap:20px">
          <div class="grid cols-2">
            <div>
              <label>Project duration</label>
              <div class="annualNote"><span class="lock">ðŸ”’</span>Annual model (12 months)</div>
              <input id="months" type="hidden" value="12" />
              <div class="printOnly note" id="stamp"></div>
            </div>
            <div>
              <label>Flights per month</label>
              <div class="row"><input id="flights" type="number" step="1" min="0" value="2" placeholder="2"><span class="suffix">flights</span></div>
            </div>
          </div>

          <!-- ROI cards â€” ordered -->
          <div class="grid cols-2">
            <!-- 1. Survey lag -->
            <div class="card">
              <h3>Survey lag avoided <span class="help" title="Source: field time studies; replacing manual topo/check cycles typically saves 2â€“4 hr per flight.">?</span></h3>
              <div class="body grid">
                <div class="row"><div>
                  <label>Hours saved per flight</label>
                  <input id="hrsSaved" type="number" step="0.1" min="0" value="2.5" placeholder="2.5"></div><span class="suffix">hr</span></div>
                <div class="row"><div>
                  <label>Survey crew rate</label>
                  <input id="surveyRate" type="number" step="10" min="0" value="170" placeholder="170"></div><span class="suffix">$/hr</span></div>
                <div class="note">Savings: <b id="surveyLagOut">$0</b></div>
              </div>
            </div>

            <!-- 2. GCP -->
            <div class="card">
              <h3>GCP tagging time saved <span class="help" title="Conservative assumption: ~20 min saved per map with autoâ€‘tag + QA (0.33 hr).">?</span></h3>
              <div class="body grid">
                <div class="row"><div>
                  <label>Hours saved per map</label>
                  <input id="gcpHours" type="number" step="0.01" min="0" value="0.33" placeholder="0.33 (~20 min)"></div><span class="suffix">hr</span></div>
                <div class="row"><div>
                  <label>VDC bill rate</label>
                  <input id="vdcRate" type="number" step="5" min="0" value="150" placeholder="150"></div><span class="suffix">$/hr</span></div>
                <div class="note">Savings uses: 12 months Ã— Flights/mo Ã— Hours Ã— Rate</div>
                <div class="note">Savings: <b id="gcpOut">$0</b></div>
              </div>
            </div>

            <!-- 3. Strike -->
            <div class="card">
              <h3>Strike prevention (postâ€‘install) <span class="help" title="Source: CGA DIRT (root causes); utility asâ€‘builts before backfill + noâ€‘dig overlays reduce hits.">?</span></h3>
              <div class="body grid">
                <div class="row"><div>
                  <label>Baseline strikes / yr</label>
                  <input id="baseStrikes" type="number" step="0.1" min="0" value="0.5" placeholder="0.5"></div><span class="suffix"></span></div>
                <div class="row"><div>
                  <label>With Aerial Pro / yr</label>
                  <input id="progStrikes" type="number" step="0.1" min="0" value="0.25" placeholder="0.25"></div><span class="suffix"></span></div>
                <div class="row"><div>
                  <label>Avg strike cost</label>
                  <input id="avgStrike" type="number" step="1000" min="0" value="25000" placeholder="25000"></div><span class="suffix">$</span></div>
                <div class="note">Savings: <b id="strikesOut">$0</b></div>
              </div>
            </div>

            <!-- 4. Rework -->
            <div class="card">
              <h3>Rework from grade errors <span class="help" title="Source: earthworks change logs; minor regrades often reach thousands of CY.">?</span></h3>
              <div class="body grid">
                <div class="row"><div>
                  <label>Cubic yards rework avoided</label>
                  <input id="reworkCY" type="number" step="100" min="0" value="1500" placeholder="1500"></div><span class="suffix">cy</span></div>
                <div class="row"><div>
                  <label>Cost per cy</label>
                  <input id="reworkRate" type="number" step="0.1" min="0" value="3.5" placeholder="3.5"></div><span class="suffix">$/cy</span></div>
                <div class="row"><div>
                  <label>Events avoided / yr</label>
                  <input id="reworkEvents" type="number" step="1" min="0" value="1" placeholder="1"></div><span class="suffix"></span></div>
                <div class="note">Savings: <b id="reworkOut">$0</b></div>
              </div>
            </div>

            <!-- 5. Disputes -->
            <div class="card">
              <h3>Fewer disputes / COs <span class="help" title="Source: CS & win/loss notes; verified quantities + visuals reduce payâ€‘app disputes and callbacks.">?</span></h3>
              <div class="body grid">
                <div class="row"><div>
                  <label>Avg dispute cost</label>
                  <input id="avgDispute" type="number" step="1000" min="0" value="20000" placeholder="20000"></div><span class="suffix">$</span></div>
                <div class="row"><div>
                  <label>Disputes avoided per year</label>
                  <input id="disputesAvoided" type="number" step="1" min="0" value="1" placeholder="1"></div><span class="suffix"></span></div>
                <div class="note">Savings: <b id="disputesOut">$0</b></div>
              </div>
            </div>

            <!-- 6. Equipment -->
            <div class="card">
              <h3>Equipment productivity <span class="help" title="Source: foreman interviews; equipment/crews idle waiting on survey updates; drones shrink wait windows.">?</span></h3>
              <div class="body grid">
                <div class="row"><div>
                  <label>Idle hours avoided / mo</label>
                  <input id="idleHrs" type="number" step="0.5" min="0" value="2"></div><span class="suffix">hr</span></div>
                <div class="row"><div>
                  <label>Equip + operator cost / hr</label>
                  <input id="equipRate" type="number" step="10" min="0" value="250"></div><span class="suffix">$/hr</span></div>
                <div class="note">Savings: <b id="equipOut">$0</b></div>
              </div>
            </div>

            <!-- 7. Travel -->
            <div class="card">
              <h3>Site visit reduction (remote sites) <span class="help" title="Source: travel policy benchmarks; avoided trips (airfare, hotel, perâ€‘diem, ground).">?</span></h3>
              <div class="body grid">
                <div class="row"><div>
                  <label>Trips avoided / yr</label>
                  <input id="tripsYr" type="number" step="1" min="0" value="3"></div><span class="suffix">trips</span></div>
                <div class="row"><div>
                  <label>Airfare per trip</label>
                  <input id="airfare" type="number" step="10" min="0" value="350"></div><span class="suffix">$</span></div>
                <div class="row"><div>
                  <label>Nights per trip</label>
                  <input id="nights" type="number" step="1" min="0" value="1"></div><span class="suffix">nights</span></div>
                <div class="row"><div>
                  <label>Hotel per night</label>
                  <input id="hotelRate" type="number" step="10" min="0" value="150"></div><span class="suffix">$</span></div>
                <div class="row"><div>
                  <label>Meals per day</label>
                  <input id="mealsPer" type="number" step="5" min="0" value="50"></div><span class="suffix">$</span></div>
                <div class="row"><div>
                  <label>Ground / trip</label>
                  <input id="groundPer" type="number" step="5" min="0" value="60"></div><span class="suffix">$</span></div>
                <div class="note">Savings: <b id="travelOut">$0</b></div>
              </div>
            </div>

          </div>

          <div class="btns">
            <button id="reset" class="ghost">Reset</button>
          </div>
        </div>
      </div>

      <!-- Right: Results & Costs -->
      <div class="card">
        <h3>Results</h3>
        <div class="body grid" style="gap:16px">
          <div class="stats">
            <div class="stat"><div class="k">Gross value</div><div class="v" id="gross">$0</div></div>
            <div class="stat"><div class="k">Program cost (year)</div><div class="v" id="cost">$0</div></div>
            <div class="stat"><div class="k">Net savings</div><div class="v" id="net">$0</div></div>
            <div class="stat"><div class="k">ROI multiple</div><div class="v" id="roi">â€”</div></div>
            <div class="stat" style="grid-column:span 2"><div class="k">Payback</div><div class="v" id="payback">â€”</div></div>
          </div>

          <div class="card" style="box-shadow:none;border:1px solid #e5e7eb">
            <div class="body">
              <div class="barlist" id="bars"></div>
            </div>
          </div>

          <!-- Program costs (stacked) -->
          <div class="card" style="box-shadow:none;border:1px solid #e5e7eb">
            <h3>Program costs</h3>
            <div class="body grid costs-stack">
              <div>
                <label>Aerial Pro subscription (year)</label>
                <div class="row"><input id="subCost" type="number" step="1000" min="0" value="24000"><span class="suffix">$</span></div>
              </div>
              <div>
                <label>Pilot hours per flight</label>
                <div class="row"><input id="pilotHrs" type="number" step="0.1" min="0" value="1.5"><span class="suffix">hr</span></div>
              </div>
              <div>
                <label>Pilot rate</label>
                <div class="row"><input id="pilotRate" type="number" step="5" min="0" value="75"><span class="suffix">$/hr</span></div>
              </div>
              <div>
                <label>Training / enablement (yr 1)</label>
                <div class="row"><input id="train" type="number" step="100" min="0" value="2000"><span class="suffix">$</span></div>
              </div>
            </div>
          </div>

          <div class="note">Notes: Annual model (12 months fixed). Subscription is annual. Savings buckets reflect 12â€‘month impact.</div>
        </div>
      </div>

    </div>
  </div>

  <script>
    const $ = (id) => document.getElementById(id);
    const fmt = (n) => n.toLocaleString(undefined,{style:'currency',currency:'USD',maximumFractionDigits:0});

    const inputs = {
      months: $('months'), flights: $('flights'),
      hrsSaved: $('hrsSaved'), surveyRate: $('surveyRate'),
      avgDispute: $('avgDispute'), disputesAvoided: $('disputesAvoided'),
      baseStrikes: $('baseStrikes'), progStrikes: $('progStrikes'), avgStrike: $('avgStrike'),
      idleHrs: $('idleHrs'), equipRate: $('equipRate'),
      reworkCY: $('reworkCY'), reworkRate: $('reworkRate'), reworkEvents: $('reworkEvents'),
      tripsYr: $('tripsYr'), airfare: $('airfare'), nights: $('nights'), hotelRate: $('hotelRate'), mealsPer: $('mealsPer'), groundPer: $('groundPer'),
      gcpHours: $('gcpHours'), vdcRate: $('vdcRate'),
      subCost: $('subCost'), pilotHrs: $('pilotHrs'), pilotRate: $('pilotRate'), train: $('train'),
    };

    function calc(){
      const months = 12; // annual model
      const flights = +inputs.flights.value || 0;

      // Savings (annual)
      const surveyLag = flights * months * ((+inputs.hrsSaved.value||0) * (+inputs.surveyRate.value||0));
      const disputes = (+inputs.avgDispute.value||0) * (+inputs.disputesAvoided.value||0);
      const strikes = Math.max((+inputs.baseStrikes.value||0) - (+inputs.progStrikes.value||0), 0) * (+inputs.avgStrike.value||0);
      const equipment = (+inputs.idleHrs.value||0) * (+inputs.equipRate.value||0) * months;
      const rework = (+inputs.reworkCY.value||0) * (+inputs.reworkRate.value||0) * (+inputs.reworkEvents.value||0);
      const perTrip = (+inputs.airfare.value||0) + ((+inputs.nights.value||0) * ((+inputs.hotelRate.value||0) + (+inputs.mealsPer.value||0))) + (+inputs.groundPer.value||0);
      const travel = (+inputs.tripsYr.value||0) * perTrip;
      const gcp = flights * months * ((+inputs.gcpHours.value||0) * (+inputs.vdcRate.value||0));

      const gross = surveyLag + gcp + strikes + rework + disputes + equipment + travel;

      // Costs (annual)
      const subscription = (+inputs.subCost.value||0);
      const capture = (+inputs.pilotHrs.value||0) * (+inputs.pilotRate.value||0) * flights * months;
      const totalCost = subscription + capture + (+inputs.train.value||0);

      const net = gross - totalCost;
      const roiMultiple = totalCost > 0 ? net / totalCost : 0;
      const monthlyNet = net / months;
      const paybackMonths = monthlyNet > 0 ? (totalCost / monthlyNet) : Infinity;

      // Update UI
      $('surveyLagOut').textContent = fmt(surveyLag);
      $('disputesOut').textContent = fmt(disputes);
      $('strikesOut').textContent = fmt(strikes);
      $('equipOut').textContent = fmt(equipment);
      $('reworkOut').textContent = fmt(rework);
      $('travelOut').textContent = fmt(travel);
      $('gcpOut').textContent = fmt(gcp);

      $('gross').textContent = fmt(gross);
      $('cost').textContent = fmt(totalCost);
      $('net').textContent = fmt(net);
      $('roi').textContent = isFinite(roiMultiple) ? (roiMultiple.toFixed(2) + 'Ã—') : 'â€”';
      $('payback').textContent = isFinite(paybackMonths) ? (paybackMonths.toFixed(1) + ' months') : 'n/a';

      // Bars â€” with value text UNDER each bar (no hover needed)
      const bars = [
        { label:'Survey lag avoided', val: surveyLag },
        { label:'GCP tagging time saved', val: gcp },
        { label:'Strike prevention', val: strikes },
        { label:'Rework avoided', val: rework },
        { label:'Fewer disputes', val: disputes },
        { label:'Equipment productivity', val: equipment },
        { label:'Site travel avoided', val: travel },
        { label:'Program cost', val: -totalCost },
      ];
      const max = Math.max(1, ...bars.map(b => Math.abs(b.val)));
      const list = $('bars');
      list.innerHTML = '';
      bars.forEach(b => {
        const pct = Math.round((Math.abs(b.val)/max)*100);
        const row = document.createElement('div');
        row.className = 'bar' + (b.val < 0 ? ' neg' : '');
        row.innerHTML = `<div class="label">${b.label}</div>
                         <div class="track"><div class="fill" style="width:${pct}%;"></div></div>
                         <div class="val">${b.val < 0 ? '-' : ''}${fmt(Math.abs(b.val))}</div>`;
        list.appendChild(row);
      });

      // Stamp (print)
      const d = new Date();
      const stamp = `Generated ${d.toLocaleString()} | Flights/mo: ${inputs.flights.value}`;
      const stampEl = $('stamp');
      if (stampEl) stampEl.textContent = stamp;

      return {gross,totalCost,net,roiMultiple,paybackMonths};
    }

    function setVals(obj){
      Object.entries(obj).forEach(([k,v])=>{ if(inputs[k]!==undefined) inputs[k].value = v; });
      calc();
    }

    const presets = {
      conservative: {
        flights:2, hrsSaved:2.5, surveyRate:170, disputesAvoided:1,
        baseStrikes:0.5, progStrikes:0.25, idleHrs:2, reworkCY:1500,
        tripsYr:3, airfare:350, nights:1, hotelRate:150, mealsPer:50, groundPer:60,
        gcpHours:0.33, vdcRate:150,
      },
      base: {
        flights:4, hrsSaved:3.5, surveyRate:180, disputesAvoided:2,
        baseStrikes:1, progStrikes:0.5, idleHrs:4, reworkCY:4000,
        tripsYr:6, airfare:450, nights:2, hotelRate:160, mealsPer:60, groundPer:80,
        gcpHours:2.0, vdcRate:150,
      },
      aggressive: {
        flights:8, hrsSaved:4.5, surveyRate:200, disputesAvoided:3,
        baseStrikes:2, progStrikes:0.5, idleHrs:8, reworkCY:8000,
        tripsYr:12, airfare:600, nights:2, hotelRate:200, mealsPer:70, groundPer:100,
        gcpHours:2.5, vdcRate:175,
      }
    };

    function applyPreset(name){
      document.querySelectorAll('.seg button').forEach(b=>b.classList.remove('active'));
      const id = name==='base' ? 'pBase' : (name==='aggressive' ? 'pAggressive' : 'pConservative');
      document.getElementById(id).classList.add('active');
      setVals(presets[name]);
    }

    function reset(){ applyPreset('base'); }

    // Print helpers
    function openPrintView(){ window.scrollTo({top:0,behavior:'smooth'}); setTimeout(()=>window.print(), 250); }

    // URL param prefill (sanitize; ignore empty). Months is locked to 12.
    const params = new URLSearchParams(location.search);
    Object.entries(inputs).forEach(([k, el])=>{
      if (k === 'months') { el.value = 12; return; }
      const raw = params.get(k);
      if (raw === null || raw === '') return;
      if (el.type === 'number') {
        const cleaned = String(raw).replace(/[$,\s]/g,'');
        const n = Number(cleaned);
        if (isFinite(n)) el.value = n;
      } else {
        el.value = raw;
      }
    });

    // Guard defaults
    if (!inputs.subCost.value || !isFinite(+inputs.subCost.value)) inputs.subCost.value = 24000;
    if (!inputs.pilotHrs.value || !isFinite(+inputs.pilotHrs.value)) inputs.pilotHrs.value = 1.5;
    if (!inputs.pilotRate.value || !isFinite(+inputs.pilotRate.value)) inputs.pilotRate.value = 75;
    if (!inputs.train.value   || !isFinite(+inputs.train.value))   inputs.train.value   = 2000;

    // Events
    document.querySelectorAll('input').forEach(el=> el.addEventListener('input', calc));
    document.getElementById('pConservative').addEventListener('click', ()=>applyPreset('conservative'));
    document.getElementById('pBase').addEventListener('click', ()=>applyPreset('base'));
    document.getElementById('pAggressive').addEventListener('click', ()=>applyPreset('aggressive'));
    document.getElementById('openPrint').addEventListener('click', ()=>window.print());
    document.getElementById('printPdf').addEventListener('click', openPrintView);

    // Init
    applyPreset('conservative');
    calc();
  </script>
</body>
</html>
