<!doctype html>
{ label:'Program cost', val: -totalCost },
];
const max = Math.max(1, ...bars.map(b => Math.abs(b.val)));
const list = $('bars');
list.innerHTML = '';
bars.forEach(b => {
const pct = Math.round((Math.abs(b.val)/max)*100);
const row = document.createElement('div');
row.className = 'bar' + (b.val < 0 ? ' neg' : '');
row.innerHTML = `<div class="label">${b.label}</div>
<div class="track"><div class="fill" style="width:${pct}%;"></div></div>`;
list.appendChild(row);
});


return {gross,totalCost,net,roiMultiple,paybackMonths,perTrip};
}


function setVals(obj){
Object.entries(obj).forEach(([k,v])=>{ if(inputs[k]) inputs[k].value = v; });
calc();
}


// Presets (conservative/base/aggressive)
const presets = {
conservative: {
flights:2, hrsSaved:2.5, surveyRate:170, disputesAvoided:1,
baseStrikes:0.5, progStrikes:0.25, idleHrs:2, reworkCY:1500,
tripsYr:3, airfare:350, nights:1, hotelRate:150, mealsPer:50, groundPer:60,
gcpHours:1.5, vdcRate:150,
},
base: {
flights:4, hrsSaved:3.5, surveyRate:180, disputesAvoided:2,
baseStrikes:1, progStrikes:0.5, idleHrs:4, reworkCY:4000,
tripsYr:6, airfare:450, nights:2, hotelRate:160, mealsPer:60, groundPer:80,
gcpHours:2.0, vdcRate:150,
},
aggressive: {
flights:8, hrsSaved:4.5, surveyRate:200, disputesAvoided:3,
baseStrikes:2, progStrikes:0.5, idleHrs:8, reworkCY:8000,
tripsYr:12, airfare:600, nights:2, hotelRate:200, mealsPer:70, groundPer:100,
gcpHours:2.5, vdcRate:175,
}
};


function applyPreset(name){
document.querySelectorAll('.seg button').forEach(b=>b.classList.remove('active'));
const btn = name==='base'? document.getElementById('pBase') : name==='aggressive'? document.getElementById('pAggressive') : document.getElementById('pConservative');
btn.classList.add('active');
setVals(presets[name]);
}


function reset(){
// Reset to Base preset + 12 months
$('months').value = 12;
applyPreset('base');
}


function copySummary(){
const r = calc();
const lines = [
'Aerial Pro ROI Summary',
`Duration: ${inputs.months.value} mo | Flights/mo: ${inputs.flights.value}`,
`Gross annual value: ${fmt(r.gross)}`,
`Program cost (year): ${fmt(r.totalCost)}`,
`Net annual savings: ${fmt(r.net)}`,
`ROI multiple: ${isFinite(r.roiMultiple) ? r.roiMultiple.toFixed(2)+'x' : 'â€”'}`,
`Payback: ${isFinite(r.paybackMonths) ? r.paybackMonths.toFixed(1)+' mo' : 'n/a'}`,
];
navigator.clipboard.writeText(lines.join('\n')).then(()=>alert('Summary copied to clipboard.'));
}


// Wire events
document.querySelectorAll('input').forEach(el=> el.addEventListener('input', calc));
$('reset').addEventListener('click', reset);
$('copy').addEventListener('click', copySummary);
document.getElementById('pConservative').addEventListener('click', ()=>applyPreset('conservative'));
document.getElementById('pBase').addEventListener('click', ()=>applyPreset('base'));
document.getElementById('pAggressive').addEventListener('click', ()=>applyPreset('aggressive'));


// Initialize: conservative by default, then calculate
applyPreset('conservative');
calc();
</script>
</body>
</html>
